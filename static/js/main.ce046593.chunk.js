(this["webpackJsonpsea-battle"]=this["webpackJsonpsea-battle"]||[]).push([[0],{13:function(e,t,n){},14:function(e,t,n){},16:function(e,t,n){"use strict";n.r(t);var r=n(2),i=n.n(r),c=n(5),o=n.n(c),a=(n(13),n(3)),l=n(1),s=n(7),u=n(4);n(14);function d(e){return{keys:e.map((function(e){return e.id})),entries:e.reduce((function(e,t){return Object(l.a)(Object(l.a)({},e),{},Object(a.a)({},t.id,t))}),{})}}var h=n(0),j=20,b=Array.from(Array(10)).map((function(e,t){return t+1})),f=["\u0430","\u0431","\u0432","\u0433","\u0434","\u0435","\u0436","\u0437","\u0438","\u043a"],x={blue:"#3399cc",black:"#000000",red:"#cc0000",gray:"#999999",transparent:"rgba(0,0,0,0)"};function v(e){var t="Game-object__rect"+(e.className?" ".concat(e.className):"");return Object(h.jsx)("rect",{width:e.width*j+1,height:e.height*j+1,x:e.x*j,y:e.y*j,className:t,stroke:x[e.color],onPointerDown:e.onPointerDown})}function y(e){return Object(h.jsx)("circle",{cx:e.x*j+10+.5,cy:e.y*j+10+.5,r:e.r,fill:x[e.color]})}function O(e){return Object(h.jsxs)("div",{style:{position:"relative"},children:[Object(h.jsx)("div",{className:"Game-object__background",style:{position:"absolute",top:10,left:10,right:9,bottom:9}}),Object(h.jsx)("svg",{className:"Game-object__zone",width:e.width*j,height:e.height*j,viewBox:"".concat(e.x*j-10," ").concat(e.y*j-10," ").concat(e.width*j," ").concat(e.height*j),children:e.children})]})}function p(e){var t,n;return Object(h.jsx)("text",{x:e.x*j+10+1,y:e.y*j+10+1,fontFamily:"inherit",dominantBaseline:"middle",textAnchor:"middle",fontSize:null!==(t=e.fontSize)&&void 0!==t?t:12,fill:null!==(n=e.color)&&void 0!==n?n:x.black,children:e.children})}function m(e){var t=e.x,n=e.y,i=e.isInteractive,c=void 0!==i&&i,o=e.onCellClick,a=Object(r.useState)(null),l=Object(u.a)(a,2),s=l[0],d=l[1];return Object(h.jsxs)("g",{onPointerMove:function(e){if(c){var r=e.currentTarget.getBoundingClientRect(),i=r.top,o=r.left,a=e.clientX-o,l=e.clientY-i,s=Math.floor(a/j),u=Math.floor(l/j);d(s<1||s>10||u<1||u>10?null:{x:s+t,y:u+n})}},onPointerLeave:function(){return d(null)},onPointerUp:function(){c&&(null===o||void 0===o||o(s))},children:[Object(h.jsx)(v,{width:10,height:10,x:t+1,y:n+1,color:"black"}),b.map((function(e,r){return Object(h.jsx)(p,{x:t,y:n+r+1,children:e},e)})),f.map((function(e,r){return Object(h.jsx)(p,{x:t+r+1,y:n,children:e.toUpperCase()},e)})),s&&Object(h.jsx)(v,{width:1,height:1,x:s.x,y:s.y,color:"transparent",className:"Cell Cell--hovered"})]})}function g(e){var t=1,n=1;"horizontal"===e.orientation?t=e.size:n=e.size;var r="Ship";return e.isDraggable&&(r+=" Ship--draggable"),e.isDragging&&(r+=" Ship--dragging"),Object(h.jsx)(v,{width:t,height:n,x:e.x,y:e.y,color:e.color,className:r,onPointerDown:e.onPointerDown})}function z(e){var t=Object(r.useState)([]),n=Object(u.a)(t,2),i=n[0],c=n[1],o=Object(r.useMemo)((function(){return d(e.enemyShips)}),[e.enemyShips]),a=Object(r.useMemo)((function(){var t,n={},r=Object(s.a)(e.enemyShips);try{for(r.s();!(t=r.n()).done;)for(var i=t.value,c=i.x,o=i.y,a=i.size,l=i.orientation,u="horizontal"===l?a:1,d="vertical"===l?a:1,h=c;h<c+u;h++)for(var j=o;j<o+d;j++)n[h]=n[h]||{},n[h][j]=i.id}catch(b){r.e(b)}finally{r.f()}return n}),[e.enemyShips]),l=Object(r.useRef)({});return Object(h.jsxs)("div",{children:[Object(h.jsx)("h2",{children:"\u0411\u0438\u0442\u0432\u0430!"}),Object(h.jsx)("div",{className:"App__game-field-wrapper",children:Object(h.jsxs)(O,{x:0,y:0,width:25,height:13,children:[Object(h.jsx)(m,{x:0,y:0}),e.ships.map((function(e){return Object(h.jsx)(g,{x:e.x,y:e.y,size:e.size,orientation:e.orientation,color:"black"},e.id)})),i.map((function(e){var t;return e.x<13||e.x>22||e.y<1||e.y>10?null:null==(null===(t=a[e.x])||void 0===t?void 0:t[e.y])?Object(h.jsx)(y,{x:e.x,y:e.y,color:"red",r:3},"".concat(e.x,"-").concat(e.y)):Object(h.jsx)(p,{x:e.x,y:e.y,color:"red",fontSize:15,children:"X"},"".concat(e.x,"-").concat(e.y))})),Object(h.jsx)(m,{x:12,y:0,isInteractive:!0,onCellClick:function(e){return c((function(t){var n;if(null==e)return t;if(t.find((function(t){return t.x===e.x&&t.y===e.y})))return t;if(null!=(null===(n=a[e.x])||void 0===n?void 0:n[e.y])){var r=a[e.x][e.y];if(l.current[r]=l.current[r]||0,l.current[r]++,l.current[r]===o.entries[r].size){for(var i=o.entries[r],c=[],s=i.x,u=i.y,d=i.size,h=i.orientation,j="horizontal"===h?d:1,b="vertical"===h?d:1,f=function(e){for(var n=function(n){null==t.find((function(t){var r=t.x,i=t.y;return r===e&&i===n}))&&c.push({x:e,y:n})},r=u-1;r<u+b+1;r++)n(r)},x=s-1;x<s+j+1;x++)f(x);return 0===c.length?t:t.concat(c)}}return t.concat(e)}))}})]})})]})}function w(e){var t=Object(r.useState)((function(){return d(k({x:1,y:1,width:10,height:10}))})),n=Object(u.a)(t,2),i=n[0],o=n[1],s=Object(r.useState)(null),b=Object(u.a)(s,2),f=b[0],x=b[1],v=Object(r.useMemo)((function(){return i.keys.map((function(e){return i.entries[e]}))}),[i.keys,i.entries]),y=Object(r.useMemo)((function(){return C(v,{x:1,y:1,width:10,height:10})}),[v]),p=y.invalidShips,z=y.valid;return Object(h.jsxs)(h.Fragment,{children:[Object(h.jsxs)("div",{children:[Object(h.jsx)("h2",{children:"\u0420\u0430\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0430 \u043a\u043e\u0440\u0430\u0431\u043b\u0435\u0439"}),Object(h.jsx)("div",{className:"App__game-field-wrapper",children:Object(h.jsxs)(O,{x:0,y:0,width:25,height:13,children:[Object(h.jsx)(m,{x:0,y:0}),v.map((function(e){return Object(h.jsxs)(r.Fragment,{children:[Object(h.jsx)(g,Object(l.a)(Object(l.a)({},e),{},{x:e.x,y:e.y,color:p.has(e.id)?"red":"blue",isDraggable:!0,isDragging:f===e.id,onPointerDown:(t=e.id,function(e){e.preventDefault();var n=e.currentTarget;document.addEventListener("pointermove",u),document.addEventListener("pointerup",(function e(){Object(c.unstable_batchedUpdates)((function(){s||o((function(e){var n,r=e.entries[t];return null==r?e:Object(l.a)(Object(l.a)({},e),{},{entries:Object(l.a)(Object(l.a)({},e.entries),{},Object(a.a)({},t,(n=r,Object(l.a)(Object(l.a)({},n),{},{orientation:"horizontal"===n.orientation?"vertical":"horizontal"}))))})})),x(null)})),n.style.cursor="",document.removeEventListener("pointermove",u),document.removeEventListener("pointerup",e)}));var r,i,s=!1;function u(c){c.preventDefault();var u=c.clientX-e.clientX,d=c.clientY-e.clientY;(Math.abs(u)>j/3||Math.abs(d)>j/3)&&(s=!0,x(t),n.style.cursor="grabbing"),s&&o((function(e){var n=e.entries[t];if(null==n)return e;null!=r&&null!=i||(r=n.x,i=n.y);var c,o,s="vertical"===n.orientation?1:n.size,h="horizontal"===n.orientation?1:n.size,b=Math.min(25-s-1,Math.max(0,r+Math.round(u/j))),f=Math.min(13-h-1,Math.max(0,i+Math.round(d/j)));return n.x===b&&n.y===f?e:Object(l.a)(Object(l.a)({},e),{},{entries:Object(l.a)(Object(l.a)({},e.entries),{},Object(a.a)({},t,(c=b,o=f,function(e){return Object(l.a)(Object(l.a)({},e),{},{x:c,y:o})})(n)))})}))}})})),null!=f&&S(e)]},e.id);var t}))]})})]}),Object(h.jsxs)("div",{className:"App__buttons",children:[Object(h.jsx)("button",{onClick:function(){return o(d(k({x:1,y:1,width:10,height:10})))},children:"\u0420\u0430\u0441\u043f\u043e\u043b\u043e\u0436\u0438\u0442\u044c \u0441\u043b\u0443\u0447\u0430\u0439\u043d\u043e"}),Object(h.jsx)("button",{disabled:!z,onClick:function(){return e.onReady(v)},children:"\u0413\u043e\u0442\u043e\u0432\u043e"})]})]})}function S(e){for(var t=[],n=e.x,r=e.y,i=e.size,c=e.orientation,o="horizontal"===c?i:1,a="vertical"===c?i:1,l=n-1;l<n+o+1;l++)for(var s=r-1;s<r+a+1;s++)l>=n&&l<n+o&&s>=r&&s<r+a||l<1||l>10||s<1||s>10||t.push(Object(h.jsx)(y,{r:1.5,x:l,y:s,color:"gray"},l+"-"+s));return t}var M=[4,3,3,2,2,2,1,1,1,1];function k(e){var t,n=[],r=Object(s.a)(M);try{for(r.s();!(t=r.n()).done;)for(var i=t.value;;){var c=Math.random()<.5?"horizontal":"vertical",o=Math.floor(Math.random()*(25-i+1)),a=Math.floor(Math.random()*(13-i+1));if(n.push({x:o,y:a,size:i,orientation:c,id:n.length}),C(n,e).valid)break;n.pop()}}catch(l){r.e(l)}finally{r.f()}return n}function C(e,t){var n,r={},i=new Set,c=Object(s.a)(e);try{for(c.s();!(n=c.n()).done;){var o=n.value;u(o),a(o),l(o)}}catch(d){c.e(d)}finally{c.f()}return{invalidShips:i,valid:0===i.size};function a(e){for(var t=e.x,n=e.y,c=e.size,o=e.orientation,a="horizontal"===o?c:1,l="vertical"===o?c:1,s=t;s<t+a;s++)for(var u=n;u<n+l;u++){var d,h=null===(d=r[u])||void 0===d?void 0:d[s];null!=h&&h!==e.id&&(i.add(e.id),i.add(h))}}function l(e){for(var t=e.x,n=e.y,i=e.size,c=e.orientation,o="horizontal"===c?i:1,a="vertical"===c?i:1,l=t-1;l<t+o+1;l++)for(var s=n-1;s<n+a+1;s++)r[s]=r[s]||{},null==r[s][l]&&(r[s][l]=e.id)}function u(e){var n=e.x,r=e.y,c=e.size,o=e.orientation,a=t.y+t.height,l=t.x+t.width;n<t.x||r<t.y?i.add(e.id):"vertical"===o?(r+c>a||n>=l)&&i.add(e.id):(r>=a||n+c>l)&&i.add(e.id)}}var _=function(){var e=Object(r.useState)({type:"planning"}),t=Object(u.a)(e,2),n=t[0],i=t[1];return Object(h.jsxs)("div",{className:"App",children:[Object(h.jsx)("h1",{children:"\u041c\u043e\u0440\u0441\u043a\u043e\u0439 \u0411\u043e\u0439"}),function(){switch(n.type){case"planning":return Object(h.jsx)(w,{onReady:function(e){i({type:"battle",ships:e,enemyShips:k({x:13,y:1,width:10,height:10})})}});case"battle":return Object(h.jsx)(z,{ships:n.ships,enemyShips:n.enemyShips})}}()]})},D=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,17)).then((function(t){var n=t.getCLS,r=t.getFID,i=t.getFCP,c=t.getLCP,o=t.getTTFB;n(e),r(e),i(e),c(e),o(e)}))};o.a.render(Object(h.jsx)(i.a.StrictMode,{children:Object(h.jsx)(_,{})}),document.getElementById("root")),D()}},[[16,1,2]]]);
//# sourceMappingURL=main.ce046593.chunk.js.map